# 慣習

## パッケージ名の命名

Go では小文字の１単語で命名することが推奨されている

```txt
encodingBase64   => いまいち
encoding_base64 => いまいち
encoding/base64  => OK
```

> モジュール名とパッケージ名は必ずしも一致している必要性はないとされている

## コンストラクタ

Go にはコンストラクタという概念はなく、構造体を初期化した上で構造体のポインタを返却するメソッドを自前で定義する。
慣習的にメソッド名は New<struct_name>とするのが一般的

```go
func NewUser(name string) *User{
 return &User {
    Name: name
 }
}
```

## ビルドキャッシュ

`go nev GOCACHE`で設定されたディレクトリに格納されている

削除コマンド

```bash
go clean -cache
go clean -modcache
```

## 文法

### 定数宣言

`const`キーワードで定数を宣言可能
※const 宣言された値は使われていなくてもコンパイルエラーにならない

また**untyped constant**といい、利用箇所に応じて型が自動で決まる

### iota

列挙型に近い機能を実現してくれる
`iota`キーワードが宣言されるごとに新しく 0 からインクリメントされる。
そのまま使用すると単なる int 型の値であり型ごとの違いを判断できないので、型を作成して型を指定して宣言すべき

### 公開/非公開

大文字始まりの宣言はパッケージ外に公開され、小文字始まりはパッケージ内に閉ざされる

### メソッド

宣言方法

```go
func (t receiver_type) method_name(n param) return_type {
  // process
}
```

Go では実態のレシーバーに対するメソッドとポインタのレシーバーに対するメソッドをそれぞれ別物として宣言可能である。実態に対するメソッドの場合は自己の変更はできず、レシーバーのコピーが内部的には渡ってくる

### defer

Go では`defer`によって後処理(関数を抜ける時に実行される処理)を宣言することが可能

**<特徴>**

- 宣言した時点での変数をキャプチャする
- 宣言した順番と逆の順番で実行されていく
- 関数スコープで実行される
- 無名関数を渡すことが可能（だが関数に渡す変数はキャプチャされず、宣言関数の最終時点での変数の状態で実行される点に注意）

#### 標準パッケージでの構造体の json 化

非公開フィールドは Json 化されない

## パフォーマンス

### 構造体を引数で渡す場合

構造体を直接引数で渡すと都度データコピーが発生してオーバーヘッドが生じる
それらを無くしたい場合はポインタ(`*Type`)を渡すことで回避可能

## Database

### SQL ドライバー

https://github.com/golang/go/wiki/SQLDrivers

## Go とクラウドの相性

- シングルバイナリでデプロイが容易
- クラウドのコアスケールに応じてアプリケーションもスケールさせやすい

# Tool

## linter

- go vet
- revive
- golangci-lint

# Tips

## 外部提供される型が interface を満たしているかチェックする

ダックタイピングによる型付けのため、インターフェースをある型が急に満たさなくなるようなケースを検知できないことがある。

```go
var _ I = (*foo)(nil)

type I interface {
	doSomething()
}

type foo struct {}

func (f *foo) doSomething() {}
```

上記のような宣言をしておくと foo が interface を満たさない状態になった瞬間に IDE としてエラー検知してくれる
